**第7章 优雅地断开套接字连接**
7.1 基于TCP的半关闭
**单方面断开连接带来的危害**
closesocket意味着完全断开连接；完全断开不仅指无法传输数据，而且不能接收数据。
Half-close : 可以传输数据但无法接收数据， 或可以接收数据但无法传输。
```
int shutdown(SOCKET socket, int howto); // 成功时返回0， 失败时返回SOCKET_ERROR
// sock: 要断开的套接字句柄
// howto： 断开方式的信息
```
howto可能值如下：
- SD_RECEIVE: 断开输入流；套接字无法接收数据，即使输入缓冲收到数据也会抹去，而且无法调用输入相关函数
- SD_SEND: 断开输出流；无法传输数据。但如果输出缓冲区还留有未传输的数据，则将传递至目标主机
- SD_BOTH: 同时断开I/O流；同时中断I/O流

**为何需要半关闭**
关键点：客户端无法知道需要接收数据到何时
断开输出流时向对方主机传输EOF，调用close函数同时关闭I/O流，这样也会向对方发送EOF；但此时无法再接收对方传输的数据。这时需要调用shutdown函数，只关闭服务器端的输出流，这样既可以发送EOF，同时又保留了输入流，可以接收对方的数据
